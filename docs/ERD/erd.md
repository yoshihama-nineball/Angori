### ER図

![alt text](erd.png)

### 本サービスの概要（700文字以内）

Angoriは、ゴリラをモチーフにしたエンタメ性のあるアンガーマネジメントアプリです。<br>
ASDやHSPなどの感情コントロールの難しさや繊細さを持つユーザに対しても使いやすく、怒りの感情の持続時間や怒りの強度を小さくすることを目指します。

主要機能として、詳細な怒りログ記録、OpenAI GPT-4o-miniを活用した相談内容に対するAドバイス、どれくらい今までアンガーマネジメントに取り組んだか、ポイントによるゲーミフィケーション機能を提供します。D3.js Packed Bubble Chartで怒りのトリガとなるワードを可視化し、ユーザーが怒りパターンを直感的に理解できる仕組みを構築。従来のアンガーマネジメントツールにはない、多様性への配慮と科学的アプローチを両立。ユーザが自身の成長過程を楽しく追跡し、持続的な感情制御スキルを上げることをサポートします。

### MVPで実装する予定の機能
- [ ] アプリの解説画面の追加(新規ユーザ向け, '/')
- [ ] ユーザ登録機能
- [ ] ユーザ確認機能
- [ ] ログイン機能
- [ ] トップ画面の表示(相談室への導線、最近のアンガーログ一覧、MVP以降実装予定のスコア表など)
- [ ] アンガーマネジメント相談機能
- [ ] 相談内容に対するAIアドバイス機能
- [ ] 過去のアンガーログ一覧画面
- [ ] 過去のアンガーログ詳細画面

### ER図の注意点
- [x] プルリクエストに最新のER図のスクリーンショットを画像が表示される形で掲載できているか？
- [x] テーブル名は複数形になっているか？
- [x] カラムの型は記載されているか？
- [x] 外部キーは適切に設けられているか？
- [x] リレーションは適切に描かれているか？多対多の関係は存在しないか？
- [x] STIは使用しないER図になっているか？
- [x] Postsテーブルにpost_nameのように"テーブル名+カラム名"を付けていないか？

## 📋 レビュー対応事項

### ✅ 対応済み修正
1. **reminder_type → reminder_category**: STI予約語回避のためカラム名変更
2. **JSONBデータ詳細化**: 具体的なデータ構造例と検索クエリ例を追加
3. **location設計明確化**: MVP段階はシンプル文字列、Phase2で地図連携検討

### 📊 JSONBデータの詳細仕様

#### level_achievements（レベル達成履歴）
```json
[
  {
    "level": 5,
    "achieved_at": "2025-01-15T10:30:00Z", 
    "points_required": 500,
    "milestone_type": "continuous_logging"
  }
]
```

#### milestone_flags（マイルストーン達成フラグ）
```json
{
  "first_log_created": true,
  "first_ai_consultation": true,
  "consecutive_7_days": true,
  "consecutive_30_days": false,
  "anger_level_reduced": true
}
```

### 🔍 分析機能での活用例
```sql
-- マイルストーン達成者検索
SELECT * FROM calming_points 
WHERE milestone_flags->>'first_ai_consultation' = 'true';

-- レベル10達成者検索  
SELECT * FROM calming_points
WHERE level_achievements @> '[{"level": 10}]';
```

### 🗺️ location カラムの設計方針
- **MVP**: シンプルな文字列記録（例：「職場」「電車内」）
- **Phase2**: 地図連携機能の追加検討（緯度・経度・住所情報）

---

**注意**: 上記修正内容をdbdiagram.ioに反映し、新しいER図のスクリーンショットに更新してください。