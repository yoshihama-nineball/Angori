# Angori 機能要件定義書

*最終更新日: 2025年7月21日*

---

## 📋 概要

本ドキュメントでは、Angori（ゴリラのアンガーマネジメントアプリ）の機能要件を定義します。市場調査とペルソナ設計の結果を踏まえ、**MVP1.0（2025年8月末リリース予定）**に向けた機能の優先度と仕様を明確化します。

## 🎯 プロダクトビジョン

**「感情コントロールが苦手な人でも、ゴリラと一緒なら怒りを笑いに変えられる」**

ユーモアと専門性を両立させた、世界初のゴリラキャラクター搭載アンガーマネジメントアプリとして、従来の真面目なアプローチでは継続できなかったユーザーに新しい選択肢を提供します。

---

## 🚀 MVP1.0 機能要件

### 優先度分類

| 優先度 | 対象期間 | 説明 |
|--------|----------|------|
| **Critical** | MVP1.0 (2025年8月末) | リリースに絶対必要な機能 |
| **High** | MVP1.1 (2025年9月) | ユーザー体験向上に重要 |
| **Medium** | フェーズ2 (2025年秋) | 差別化・収益化につながる機能 |
| **Low** | 将来版 | 長期的な成長のための機能 |

---

## 🔥 Critical（MVP1.0必須機能）

### 1. ユーザー認証システム

#### 1.1 基本認証機能
- **機能**: メールアドレス・パスワードによるユーザー登録・ログイン
- **要件**:
  - パスワード強度チェック（8文字以上、英数字混在）
  - メールアドレス重複チェック
  - セッション管理（JWT認証）
- **成功基準**: ユーザー登録成功率95%以上
- **備考**: ASD/HSP特性ユーザーのプライバシー重視に配慮

#### 1.2 セキュリティ機能
- **機能**: アンガーマネジメント相談内容の暗号化保護
- **要件**:
  - データベース保存時の暗号化
  - HTTPS通信の強制
  - セッションタイムアウト（24時間）
- **成功基準**: セキュリティ脆弱性0件

### 2. アンガーログ記録機能

#### 2.1 基本記録機能
- **機能**: 怒りの状況・感情・レベルを構造化して記録
- **入力項目**:
  - **怒りレベル**: 1-10段階（「バナナ何本分...じゃなくて10段階中いくつだ？」）
  - **発生日時**: 自動取得・手動調整可能
  - **発生場所**: 自由記述（例：職場、家、電車内）
  - **状況の列挙**: 自由記述（事実と認知を混同せずに書く）
  - **トリガー**: 過去のトリガーから選択式or自由記述
  - **感情詳細**: 自由記述（怒り以外の感情も含む）
  - **身体反応**: 選択式（頭痛、動悸、手の震え、胃痛、その他）
  - **継続時間**: 分単位での記録（怒りの持続時間）
  - **対処法**: 実際に行った対処法の記録
  - **振り返り**: 後から見直した際の気づき

#### 2.2 ASD/HSP特性への配慮
- **視覚的明確さ**: 入力欄の明確な区別、必須/任意の表示
- **予測可能性**: 一貫したフォーム構造
- **詳細記録**: 細かい状況分析をサポート
- **中断・再開**: 入力途中での保存機能
- **構造化データ**: カテゴリ分類による整理
- **感覚過敏配慮**: 色彩・音響の刺激を最小限に

### 3. AIゴリラ相談機能

#### 3.1 対話システム
- **機能**: OpenAI GPT-4o-mini を活用したリアルタイム相談
- **ゴリラキャラクター仕様**:
  - **名前**: 決める必要があれば検討
  - **口調**: 親しみやすく、少しユーモラス
  - **専門性**: アンガーマネジメントの知識を持つ
  - **一貫性**: 予測可能で安心できる応答パターン
  - **配慮**: ASD/HSP特性への理解を示す

#### 3.2 相談フロー
1. **導入**: 「どうした？バナナ食うか？相談に乗るぞ？」的な親しみやすい声かけ
2. **状況確認**: ユーザーの怒りの状況を段階的に聞き取り
3. **感情整理**: 記録された内容を基に、感情の客観視をサポート
4. **アドバイス**: 個別化されたアンガーマネジメント技法の提案
5. **振り返り**: 今回の気づきや次回への活かし方を確認

#### 3.3 AIアドバイス機能
- **機能**: 相談セッション終了時の個別化アドバイス生成
- **アドバイス内容**:
  - 今回の怒りパターン分析
  - 類似過去事例との比較
  - 具体的な対処法提案
  - 予防策の提案
  - ASD/HSP特性に配慮したアドバイス
- **技術制約**: OpenAI API月10ドル上限内での運用

### 4. 過去ログ管理機能

#### 4.1 アンガーログ一覧表示
- **機能**: 過去の怒り記録を時系列で表示
- **表示項目**:
  - 発生日時
  - 怒りレベル（視覚的表示・色分け）
  - 状況の要約（最初の50文字）
  - 相談実施有無（アイコン表示）
  - トリガーカテゴリ
- **ソート機能**: 日時、怒りレベル、相談実施有無
- **フィルター機能**: 期間指定、怒りレベル範囲、トリガーカテゴリ

#### 4.2 詳細表示機能
- **機能**: 個別のアンガーログ詳細表示・編集
- **表示内容**:
  - 記録した全項目の表示
  - AIからのアドバイス履歴
  - 編集・削除機能
  - 関連する相談セッションへのリンク
- **ASD特性配慮**: 詳細データの構造化表示、情報の階層化

#### 4.3 検索機能
- **機能**: 過去ログの内容検索
- **検索対象**: 状況、感情詳細、トリガー、対処法
- **検索方式**: 部分一致検索、キーワード検索
- **成功基準**: 検索応答時間1秒以内

### 5. トップ画面・ナビゲーション

#### 5.1 ダッシュボード機能
- **機能**: ユーザーの現状を一目で把握できる画面
- **表示項目**:
  - 相談ボタン（「どうした？バナナ食うか？相談に乗るぞ？」）
  - 最新のアンガーログ（3件）
  - 落ち着きポイント（暫定表示、詳細はMVP1.1で実装）
  - 過去ログ一覧への導線
  - 今日の怒りレベル平均（当日記録がある場合）

#### 5.2 ナビゲーション
- **機能**: アプリ内の主要機能への導線
- **構成**:
  - ホーム（ダッシュボード）
  - 新しい記録
  - 過去のログ
  - 設定
- **レスポンシブ対応**: 
  - PC: サイドバー形式
  - スマホ: フッターナビ（4タブ）

### 6. 基本的なユーモア要素

#### 6.1 ゴリラキャラクターの応答パターン
- **基本パターン**:
  - 「今日の怒りはバナナ何本分...じゃなくて10段階中いくつだ？」
  - 「どうした？バナナ食うか？相談に乗るぞ？」
  - 「怒りも大事な感情だけど、一緒に整理してみようか」
  - 「ウホウホ、その気持ちよくわかるぞ」
- **配慮事項**: ユーモアと専門性のバランス維持、ASD/HSP特性への配慮

---

## 📈 High（MVP1.1 - 2025年9月）

### 1. 落ち着きポイントシステム（ゲーミフィケーション）

#### 1.1 ポイント獲得システム
- **機能**: ユーザーのアンガーマネジメント活動をスコア化し、継続的なモチベーション向上を図る
- **基本ポイント**:
  - **アンガーログ記録**: 5pt/回（記録するだけで達成感）
  - **AI相談セッション完了**: 10pt/回（相談完了での充実感）
  - **ログ振り返り**: 3pt/回（過去ログ詳細表示時）

#### 1.2 ボーナスポイントシステム
- **連続記録ボーナス**:
  - 7日連続記録: 50pt（1週間チャレンジ）
  - 14日連続記録: 100pt（2週間マスター）
  - 30日連続記録: 200pt（月間チャンピオン）
- **改善ボーナス**:
  - 前週比で平均怒りレベル1以上改善: 25pt
  - 前週比で平均怒りレベル2以上改善: 50pt
- **マイルストーンボーナス**:
  - 初回相談完了: 20pt（「勇気の一歩」ボーナス）
  - 累計相談10回達成: 30pt（「相談マスター」達成）
  - 累計相談30回達成: 50pt（「ゴリラの知恵袋」達成）

#### 1.3 レベルシステム
- **レベル計算**: 100pt区切りでレベルアップ
- **レベル名（ゴリラテーマ）**:
  - Lv.1-2: 「怒りっぽいゴリラ 🦍😤」
  - Lv.3-5: 「修行中ゴリラ 🦍🧘」
  - Lv.6-10: 「落ち着きゴリラ 🦍😌」
  - Lv.11-15: 「賢者ゴリラ 🦍🧠」
  - Lv.16+: 「禅マスターゴリラ 🦍✨」

#### 1.4 表示仕様・ユーモア要素
- **ポイント表示**: 「バナナ○本分の落ち着きを獲得！🍌」
- **レベルアップ演出**: 「ウホー！レベルアップだ！🎉」
- **リアルタイム更新**: アクション直後にポイント・レベル表示
- **進捗表示**: 次レベルまでのプログレスバー
- **達成通知**: 「今日もバナナ5本分の落ち着きをゲット！」

#### 1.5 計算ロジック仕様
```ruby
# ポイント計算メソッド
def calculate_calming_points(user)
  points = 0
  
  # 基本ポイント
  points += user.anger_logs.count * 5          # ログ記録: 5pt/回
  points += user.consultations.completed.count * 10  # 相談完了: 10pt/回
  points += user.log_views.count * 3           # ログ振り返り: 3pt/回
  
  # ボーナスポイント
  points += streak_bonus(user.calming_points.streak_days)
  points += improvement_bonus(user)
  points += milestone_bonus(user)
  
  # レベル計算
  level = (points / 100) + 1
  
  # データベース更新
  user.calming_points.update(
    total_points: points,
    current_level: level,
    streak_days: calculate_streak_days(user)
  )
end

private

# 連続記録ボーナス
def streak_bonus(streak_days)
  case streak_days
  when 7..13   then 50   # 1週間連続
  when 14..29  then 100  # 2週間連続  
  when 30..    then 200  # 1ヶ月連続
  else 0
  end
end

# 改善ボーナス
def improvement_bonus(user)
  recent_avg = user.anger_logs.where(occurred_at: 1.week.ago..).average(:anger_level)
  previous_avg = user.anger_logs.where(occurred_at: 2.weeks.ago..1.week.ago).average(:anger_level)
  
  return 0 unless recent_avg && previous_avg
  
  improvement = previous_avg - recent_avg
  case improvement
  when 2.. then 50  # 2レベル以上改善
  when 1.. then 25  # 1レベル以上改善
  else 0
  end
end

# マイルストーンボーナス
def milestone_bonus(user)
  consultation_count = user.consultations.completed.count
  case consultation_count
  when 1 then 20   # 初回相談
  when 10 then 30  # 相談マスター
  when 30 then 50  # ゴリラの知恵袋
  else 0
  end
end

# 連続記録日数計算
def calculate_streak_days(user)
  logs = user.anger_logs.order(occurred_at: :desc)
  return 0 if logs.empty?
  
  streak = 0
  current_date = Date.current
  
  logs.each do |log|
    log_date = log.occurred_at.to_date
    break if log_date < current_date - streak.days
    
    if log_date == current_date - streak.days
      streak += 1
      current_date = log_date
    end
  end
  
  streak
end
```

#### 1.6 データベース設計
```sql
calming_points (
  id: BIGINT PRIMARY KEY,
  user_id: BIGINT NOT NULL UNIQUE REFERENCES users(id),
  total_points: INTEGER DEFAULT 0,
  current_level: INTEGER DEFAULT 1,
  streak_days: INTEGER DEFAULT 0,
  last_action_date: DATE,
  level_achievements: JSONB, -- レベル達成履歴
  milestone_flags: JSONB,    -- マイルストーン達成フラグ
  created_at: TIMESTAMP,
  updated_at: TIMESTAMP
)

-- level_achievements例
{
  "level_2": "2025-08-01T10:00:00Z",
  "level_5": "2025-08-15T14:30:00Z"
}

-- milestone_flags例  
{
  "first_consultation": true,
  "consultation_master": true,
  "gorilla_wisdom": false
}
```

#### 1.7 成功基準・KPI
- **ユーザーエンゲージメント向上**: 平均セッション時間8分以上
- **継続利用促進**: 7日継続率30%以上達成
- **モチベーション維持**: ポイント獲得時のユーザー満足度4.5/5.0以上
- **ゲーミフィケーション効果**: レベルアップ時の継続利用率向上15%以上

#### 1.8 将来拡張予定
- **バッジシステム**: 特定条件達成でのバッジ獲得
- **リーダーボード**: 匿名での競争要素（オプション機能）
- **カスタマイズ**: ユーザー独自のゴール設定機能
- **ソーシャル機能**: 成果のシェア機能（プライバシー配慮）

### 2. Googleログイン連携
- **機能**: Googleアカウントでの簡単ログイン
- **目的**: 登録障壁の軽減
- **実装**: Next.js NextAuth.js + Rails Omniauth
- **セキュリティ**: OAuth2.0準拠、スコープ最小限

### 3. PWA（プログレッシブウェブアプリ）化
- **機能**: ネイティブアプリ同様の体験提供
- **要件**: 
  - オフライン閲覧（記録済みデータ）
  - プッシュ通知基盤
  - ホーム画面追加機能
  - アプリアイコン設定
- **技術**: Next.js PWA、Service Worker

### 4. 過去ログ高度検索
- **機能**: より詳細な検索・フィルター機能
- **追加要素**: 
  - タグ検索
  - 期間指定（カレンダーUI）
  - 複合条件（AND/OR検索）
  - 怒りレベル範囲指定
  - トリガーカテゴリ絞り込み
- **パフォーマンス**: PostgreSQL全文検索活用

---

## 🔧 Medium（フェーズ2 - 2025年秋）

### 1. D3.js 怒りの傾向バブルマップ
- **機能**: 怒りのトリガーや傾向を視覚的にマップ表示
- **仕様**:
  - **最大10個のバブル表示**（パフォーマンス考慮）
  - **バブルサイズ**: 出現頻度（count）
  - **バブル色**: 平均怒りレベル（anger_level_avg）
  - **インタラクティブ操作**: クリックで詳細表示、ホバーで情報表示
  - **カテゴリ分類**: work, family, social, sensory, other
- **技術**: D3.js v7 Packed Bubble Chart
- **データ形式**: 
```javascript
{
  name: "triggers",
  children: [
    {
      name: "締切プレッシャー",
      value: 15,          // 出現回数（バブルサイズ）
      angerLevel: 7.5,    // 平均怒りレベル（色）
      category: "work"
    }
  ]
}
```

### 2. プッシュ通知・リマインダー
- **機能**: 記録・相談の習慣化サポート
- **通知タイミング**: 
  - カスタマイズ可能（時間設定）
  - 記録忘れ防止（1日1回）
  - 相談推奨（怒りレベル高時）
- **通知内容**: ゴリラキャラクターの親しみやすいメッセージ

### 3. パスワードリセット機能
- **機能**: メール認証によるパスワード再設定
- **実装**: Devise標準機能活用
- **UI**: ゴリラテーマに統一

### 4. 利用規約・お問い合わせページ
- **機能**: 法的要件・ユーザーサポート対応
- **内容**: 
  - プライバシーポリシー
  - 利用規約
  - お問い合わせフォーム
  - FAQ（よくある質問）

---

## 💰 Low（将来版）

### 1. 収益化機能
- **アフィリエイト**: 関連書籍・グッズの紹介
- **アドセンス**: 適切な広告配置（UX を損なわない範囲）
- **プレミアム機能**: 高度な分析・アドバイス機能

### 2. バッジ・実績システム
- **機能**: 相談回数、継続日数、成長実績のゲーミフィケーション
- **種類**: 
  - 相談マスター（累計相談回数）
  - クールダウンキング（怒り鎮静効果）
  - 継続チャンピオン（連続利用日数）
  - 早起きゴリラ（朝の記録）
  - 夜更かしゴリラ（深夜の記録）

### 3. 格言・名言表示機能
- **機能**: トップ画面での日替わり格言表示
- **連動**: 相談機能との組み合わせ
- **内容**: アンガーマネジメント関連の名言、ゴリラオリジナル格言

---

## ⚙️ 非機能要件

### 1. パフォーマンス要件

| 項目 | 要件 | 測定方法 |
|------|------|----------|
| **ページ読み込み時間** | 3秒以内 | Lighthouse測定 |
| **AI応答時間** | 10秒以内 | ユーザー離脱防止のため |
| **検索応答時間** | 1秒以内 | UX品質維持 |
| **同時ユーザー数** | 100人 | 個人開発規模として十分 |
| **データベースクエリ** | 100ms以内 | 主要なCRUD操作 |

### 2. セキュリティ要件

| 項目 | 要件 | 実装方法 |
|------|------|----------|
| **データ暗号化** | 相談内容の機密保護 | データベース暗号化 |
| **通信暗号化** | HTTPS強制 | SSL証明書適用 |
| **認証セキュリティ** | JWT実装 | セッション管理 |
| **API保護** | OpenAI APIキー保護 | 環境変数管理 |
| **入力検証** | SQLインジェクション防止 | Rails標準バリデーション |

### 3. アクセシビリティ要件

| 対象特性 | 配慮事項 | 実装方法 |
|----------|----------|----------|
| **ASD特性** | 予測可能性、構造化 | 一貫したUI設計、明確なナビゲーション |
| **HSP特性** | 感覚刺激の調整 | 色彩・音響の配慮、刺激の軽減 |
| **視覚的明確さ** | 曖昧さの排除 | 明確なラベリング、コントラスト確保 |
| **操作の簡潔性** | 認知負荷の軽減 | シンプルなワークフロー、ステップ分割 |

### 4. 技術制約

| 項目 | 制約 | 理由 |
|------|------|------|
| **OpenAI API予算** | 月10ドル | 個人開発の予算制約 |
| **ホスティング** | Vercel + Render | コスト効率性 |
| **データベース** | PostgreSQL | 既存技術スタック |
| **フロントエンド** | Next.js 15 | 既存技術スタック |

---

## 📊 成功指標・KPI

### 1. 継続利用指標

| 指標 | 目標値 | 業界平均 | 測定方法 |
|------|--------|----------|----------|
| **7日継続率** | 30%以上 | 6% | アクティブユーザー追跡 |
| **30日継続率** | 15%以上 | 3.3% | ユーザー行動分析 |
| **平均利用頻度** | 週3回以上 | - | セッション数計測 |

### 2. 機能利用指標

| 指標 | 目標値 | 測定方法 |
|------|--------|----------|
| **アンガーログ記録率** | 80%以上 | 登録ユーザーに対する記録率 |
| **AI相談利用率** | 60%以上 | 記録に対する相談率 |
| **過去ログ閲覧率** | 40%以上 | 振り返り機能の利用率 |

### 3. ユーザー満足度指標

| 指標 | 目標値 | 測定方法 |
|------|--------|----------|
| **ユーザー満足度** | 4.5/5.0以上 | アプリ内評価機能 |
| **NPS（推奨度）** | 50以上 | 定期的なアンケート |
| **怒り継続時間短縮** | 50%減 | 自己申告ベース |

---

## 🗓️ 開発スケジュール

### MVP1.0 開発計画（2025年7月18日〜8月18日）

| 期間 | 主要タスク | 成果物 |
|------|------------|--------|
| **7月18日-25日** | 企画・設計フェーズ | 市場調査、ペルソナ、要件定義 |
| **7月26日-8月3日** | 基盤開発 | 認証、データベース、基本UI |
| **8月4日-10日** | コア機能開発 | アンガーログ、AI相談機能 |
| **8月11日-15日** | 過去ログ・統合 | 過去ログ管理、機能統合 |
| **8月16日-18日** | テスト・リリース | ユーザーテスト、MVP完成 |

### MVP以降の開発計画（2025年8月19日〜9月4日）

| 期間 | 主要タスク | 成果物 |
|------|------------|--------|
| **8月19日-24日** | MVP後機能実装 | 落ち着きポイント、PWA化 |
| **8月25日-29日** | 追加機能・改善 | Googleログイン、高度検索 |
| **8月30日-9月4日** | 調整・収益化準備 | アドセンス調査、最終調整 |

---

## 🔄 将来の機能拡張ロードマップ

### フェーズ1: MVP強化（2025年8月19日-9月4日）
- 落ち着きポイントシステム
- PWA化
- Googleログイン
- 高度検索機能
- アドセンス調査・導入準備

### フェーズ2: 差別化強化（2025年9月-10月）
- D3.js バブルマップ
- プッシュ通知システム
- ユーモア要素の拡充
- 利用規約・お問い合わせページ

### フェーズ3: 収益化・拡張（2025年11月-）
- アフィリエイト・アドセンス本格運用
- プレミアム機能検討
- B2B展開検討

---

## 🛡️ リスク管理

### 技術リスク

| リスク | 影響度 | 対策 |
|--------|--------|------|
| **OpenAI API制限** | 高 | 使用量監視、代替API検討（Claude API等） |
| **パフォーマンス問題** | 中 | 定期的な性能測定、インデックス最適化 |
| **セキュリティ脆弱性** | 高 | 定期的なセキュリティ監査、依存関係更新 |

### ビジネスリスク

| リスク | 影響度 | 対策 |
|--------|--------|------|
| **ユーザー受容性** | 高 | ユーザーテストの実施、段階的機能追加 |
| **競合参入** | 中 | 差別化要素の強化、先行者利益確保 |
| **法的問題** | 中 | 利用規約の整備、専門家相談 |

---

## 📝 開発指針

### 1. ユーザー中心設計
- **ASD/HSP特性**への継続的配慮
- **ユーザビリティテスト**の定期実施
- **アクセシビリティ**の優先
- **段階的機能追加**によるユーザー負荷軽減

### 2. 段階的リリース
- **MVP1.0**で実用性確保
- **ユーザーフィードバック**による機能改善
- **データドリブン**な機能拡張
- **継続的デプロイ**による迅速な改善

### 3. 品質重視
- **セキュリティファースト**
- **パフォーマンス最適化**
- **継続的なテスト実施**
- **コードレビュー**による品質担保

### 4. 技術的配慮
- **スケーラビリティ**を考慮した設計
- **メンテナンス性**の高いコード
- **ドキュメント**の充実
- **モニタリング**による運用品質向上

---

## 🔗 関連ドキュメント

### 企画・設計
- **市場調査報告書** (`docs/Planning/market-research.md`)
- **ペルソナ定義書** (`docs/Planning/persona.md`)
- **プロジェクト企画書** (`docs/Planning/project-planning.md`)

### 技術設計
- **ER図設計書** (`docs/DesignDocuments/er-diagram/`)
- **API仕様書** (実装後作成予定)
- **フロントエンド設計書** (実装後作成予定)

### 運用・保守
- **デプロイガイド** (`README.md`)
- **トラブルシューティング** (実装後作成予定)
- **ユーザーマニュアル** (リリース後作成予定)

---

## 📞 改訂履歴

| 版数 | 日付 | 改訂内容 | 担当者 |
|------|------|----------|--------|
| 1.0 | 2025年7月18日 | 初版作成 | 企画チーム |
| 1.1 | 2025年7月21日 | 落ち着きポイントシステム詳細追加、D3.js仕様詳細化 | 企画チーム |
